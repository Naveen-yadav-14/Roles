{{>headers}}
<title>Permissions</title>
<div class="row p-2" style="margin: 0px !important;">
    <div class="col-md-12">
        <div class="card mt-2">
            <div class="alert-success">{{success}}</div>
            <div class="alert-danger">{{error}}</div>
            <div class="card-header">
                <h4><b style="font-weight:bolder; color:  white !important ">Permissions</b></h4>
            </div>
            <div class="card-body p-2">
                <div id="example1_wrapper">
                    <div class="row">
                        {{!-- {{#if (includes userPermissions "permissions.add")}}
                        <div class="col-sm-12">
                            <ol class="float-sm-right">
                                <button href="" id="" data-bs-toggle="modal" data-bs-target="#addModal"
                                    style="background-color: #4A3AFF; color:white; border:none; border-radius:5px; width: 180px; height: 40px; "><i
                                        class="fa-solid fa-plus"></i> Add Permission</button>
                            </ol>
                        </div>
                        {{/if}} --}}
                        <div class="col-sm-12">
                            <ol class="float-sm-right">
                                <button href="" id="" data-bs-toggle="modal" data-bs-target="#addModal"
                                    style="background-color: #4A3AFF; color:white; border:none; border-radius:5px; width: 180px; height: 40px; "><i
                                        class="fa-solid fa-plus"></i> Add Permission</button>
                            </ol>
                        </div>
                        <div class="col-sm-12 table-responsive">
                            <table id="example2" aria-describedby="example1_info">
                                <thead>
                                    <tr>
                                        <th class="sorting" tabindex="0" aria-controls="example1">S.No</th>
                                        <th class="sorting" tabindex="0" aria-controls="example1">Id</th>
                                        <th class="sorting" tabindex="0" aria-controls="example1">Name</th>
                                        <th class="sorting" tabindex="0" aria-controls="example1">Slug</th>
                                        <th class="sorting" tabindex="0" aria-controls="example1">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each allPermissions}}
                                    <tr class="odd">
                                        <td>{{inc @index}}</td>
                                        <td>{{this._id}}</td>
                                        <td>{{this.name}}</td>
                                        <td>{{this.slug}}</td>
                                        {{!-- <a href="javascript:void(0);" data-bs-toggle="modal"
                                            data-bs-target="#updateModal" class="btn btn-md btn-info m-1"
                                            data-id="{{this._id}}" data-status="{{this.status}}">
                                            <i class="fa-solid fa-edit"></i>
                                        </a> --}}
                                        <td>
                                            <div class="eye d-flex justify-content-center">
                                                <a href="javascript:void(0);" data-bs-toggle="modal"
                                                    data-id="{{this._id}}" data-bs-target="#deleteModal"
                                                    class="btn btn-md btn-danger m-1">
                                                    <i class="fa-solid fa-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 style="color: black; font-weight: bold; font-size: 40px;">Add Permission</h5>
            </div>
            <form action="/admin/addpermission" id="addBannerForm" method="post">
                <div class="modal-body">
                    <label for="name">Permission Name</label>
                    <input type="text" class="form-control" name="name" required>
                    <label for="name">Slug Name</label>
                    <input type="text" class="form-control" name="slug" required>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" id="addBannerBtn"
                        style="background-color: #4A3AFF; color:white">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>
{{!-- <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: black; font-weight: bold;">Update Banner</h3>
            </div>
            <form action="/superadmin/updatebanner/{{this._id}}" id="updateModalForm" method="post"
                enctype="multipart/form-data">
                <div class="modal-body">
                    <label for="picture">Picture</label>
                    <input type="file" class="modal-file" accept="image/*" name="picture">
                </div>
                <div class="modal-body">
                    <label for="status">Status</label>
                    <select name="status" id="" class="form-control status">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="updateBtn" disabled class="btn btn-success">Update</button>
                </div>
            </form>
        </div>
    </div>
</div> --}}
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 style="color: black; font-weight: 480;">Are you sure you want to delete this?</h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <a href="/superadmin/deletepermission/{{this._id}}" type="button" class="btn btn-danger"> yes </a>
            </div>
        </div>
    </div>
</div>
{{>footer}}
</body>
<script>
    const form = document.getElementById("updateModalForm");
    const addBannerForm = document.getElementById("addBannerForm");
    const updateBtn = document.getElementById("updateBtn");

    // Store initial form data
    const initialFormData = new FormData(form);

    form.addEventListener("input", () => {
        const currentFormData = new FormData(form);
        // Compare each field with initial value
        let isChanged = false;
        const fileInput = document.getElementById("bannerImage");
        for (let [key, value] of currentFormData.entries()) {
            if (value !== initialFormData.get(key)) {
                isChanged = true;
                break;
            }
        }
        // Enable or disable the button based on changes
        updateBtn.disabled = !isChanged;
    });

    function fileValidation(element) {
        element.addEventListener("change", function () {
            const file = this.files[0];
            if (file) {
                const validTypes = ["image/jpeg", "image/png", "image/webp", "image/jpg"];

                if (!validTypes.includes(file.type)) {
                    alert("Only image format is acceptable.");
                    this.value = ""; // Clear the file input
                } else {
                    console.log("âœ… Valid image selected:", file.name);
                }
            }
        });
    }

    fileValidation(form.elements.picture)
    fileValidation(addBannerForm.elements.picture)

    addBannerForm.addEventListener('submit', () => {
        addBannerForm.elements.addBannerBtn.disabled = true
    })
    form.addEventListener('submit', () => {
        updateBtn.disabled = true
    })
</script>
<script>
    $(document).ready(function () {
        if (!$.fn.DataTable.isDataTable('#example2')) {
            $('#example2').addClass('table table-bordered table-striped').DataTable({
                "paging": true,
            });
        }
    });
</script>
<script>
    $(document).ready(function () {
        $('#updateModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var projectId = button.data('id');
            var status = button.data('status');
            var modal = $(this);
            modal.find('form').attr('action', '/superadmin/updatebanner/' + projectId);
            modal.find('.status').val(status);
        });
    });
</script>

<script>
    $(document).ready(function () {
        $('#deleteModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var projectId = button.data('id');
            var modal = $(this);
            modal.find('a.btn-danger').attr('href', '/superadmin/deletepermission/' + projectId);
        });
    });
</script>

</html>